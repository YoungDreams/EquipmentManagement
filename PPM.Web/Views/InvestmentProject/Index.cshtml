@using Foundation.Core;
@using PensionInsurance.Entities
@using PensionInsurance.Shared
@using PensionInsurance.Web.Common
@model PensionInsurance.Web.Views.InvestmentProject.IndexViewModel

@section Styles{
    <link href=@Url.Content("~/assets/global/plugins/bootstrap-select/css/bootstrap-select.min.css") rel="stylesheet" type="text/css" />
}
<!-- BEGIN PAGE BAR -->
@section Breadcrumb{
    <div class="page-bar">
        <ul class="page-breadcrumb">
            <li>
                <a href="@Url.Action("Index","Home")">首页</a>
                <i class="fa fa-circle"></i>
            </li>
            <li>
                <span>项目信息</span>
            </li>
        </ul>
    </div>
}
<!-- END PAGE BAR -->
<div class="row">
    <div class="col-md-12">
        <div class="portlet">
            <div class="portlet-title">
                <div class="caption">
                    <i class="fa fa-search"></i>项目信息查询
                </div>
            </div>
            <div class="portlet-body form">
                <!-- BEGIN FORM-->
                <form action="@Url.Action("Index","InvestmentProject",new {page = Model.Items.Page,pageSize = Model.Items.PageSize})" class="form-horizontal">
                    <div class="form-body">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="control-label col-md-3">项目名称</label>
                                    <div class="col-md-9">
                                        <input type="text" class="form-control" name="Query.Name" value="@Model.Query.Name" />
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="control-label col-md-3">项目类型</label>
                                    <div class="col-md-9">
                                        @Html.DropDownListFor(x => x.Query.Types, Model.Types, new { multiple = "", @class = "selectpicker" })
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="control-label col-md-3">项目状态</label>
                                    <div class="col-md-9">
                                        @Html.DropDownListFor(x => x.Query.Status, Model.Status, new { multiple = "", @class = "selectpicker" })
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--/row-->
                    </div>
                    <div class="form-actions">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="row">
                                    <div class="col-md-offset-5">
                                        <button type="submit" class="btn green">查询</button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6"> </div>
                        </div>
                    </div>
                </form>
                <!-- END FORM-->
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <div class="tabbable-custom">
            <ul class="nav nav-tabs">
                <li class="active">
                    <a data-showloading="true" href="@Url.Action("Index", "InvestmentProject", Model.Query)"> 项目信息 </a>
                </li>
                <li class="">
                    <a data-showloading="true" href="@Url.Action("Map", "InvestmentProject", Model.Query)"> 地图显示 </a>
                </li>
            </ul>
            <div class="tab-content">
                <div class="table-toolbar">
                    <div class="row">
                        <div class="col-md-6">
                            @if (PensionInsurance.Shared.WebAppContext.Current.User.HasPermission(ModuleType.项目信息管理, Permission.新增))
                            {

                                <a href="@Url.Action("Create", "InvestmentProject")" class="btn green">
                                    <i class="fa fa-plus" aria-hidden="true"></i>
                                    新增
                                </a>
                            }
                        </div>
                    </div>
                </div>
                <div class="table">
                    <table class="table table-hover table-scrollable">
                        <thead>
                            <tr>
                                <th>项目名称</th>
                                <th>城市</th>
                                <th>项目类型</th>
                                <th>项目状态</th>
                                <th>建筑面积</th>
                                <th>地上建筑面积</th>
                                <th>地下建筑面积</th>
                                <th>房间数</th>
                                <th>床位数</th>
                                <th>KMZ文件</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.Items)
                            {
                                <tr>
                                    <td> @item.Name </td>
                                    <td> @(item.Area.Name) </td>
                                    <td> @item.InvestmentProjectType.ToString() </td>
                                    <td> @item.Status.ToString()</td>
                                    <td> @item.BuildingAcreage.FormatString()</td>
                                    <td> @item.BuildingAcreageGround.FormatString()</td>
                                    <td> @item.BuildingAcreageUnderGround.FormatString()</td>
                                    <td> @item.RoomAmount.ToString()</td>
                                    <td> @item.BedAmount.ToString()</td>
                                    <td>
                                        @if (!item.GoogleEarthFileName.IsNullOrWhiteSpace())
                                        {
                                            <a href="@Url.Content(item.GoogleEarthFilePath)">@item.GoogleEarthFileName</a>
                                        }
                                    </td>
                                    <td>
                                        @if (PensionInsurance.Shared.WebAppContext.Current.User.HasPermission(ModuleType.项目信息管理, Permission.查看))
                                        {
                                            <a href="@Url.Action("Detail", "InvestmentProject", new {id = item.Id})" class="btn default btn-xs blue-stripe">查看</a>
                                        }
                                        @if (PensionInsurance.Shared.WebAppContext.Current.User.HasPermission(ModuleType.项目信息管理, Permission.编辑))
                                        {
                                            <a href="@Url.Action("Edit", "InvestmentProject", new {id = item.Id})" class="btn default btn-xs yellow-stripe">编辑</a>
                                        }
                                        <button data-clipboard data-clipboard-text="@($"http://api.map.baidu.com/marker?location={item.Latitude},{item.Longitude}&title={item.Name}&content={item.Address}&output=html")" data-clipboard-action="copy" class="btn default btn-xs green-stripe">分享</button>
                                        @if (PensionInsurance.Shared.WebAppContext.Current.User.HasPermission(ModuleType.项目信息管理, Permission.删除))
                                        {
                                            <a href="javascript:;" data-command="@Model.DeleteCommand(item.Id).ToJavascript()" class="btn default btn-xs red-stripe">
                                                删除
                                            </a>
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                    @Html.Partial("_Pagination", Model.Items)
                </div>
            </div>
        </div>
    </div>
</div>
@section Scripts{
    <script src=@Url.Content("~/assets/global/plugins/bootstrap-select/js/bootstrap-select.min.js") type="text/javascript"></script>
    <script src=@Url.Content("~/assets/global/plugins/clipboard/dist/clipboard.js") type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.selectpicker').selectpicker({
                style: 'btn-xs',
                iconBase: 'fa',
                tickIcon: 'fa-check',
                noneSelectedText: "--未选择--"
            });

            $("select[name='Query.Types']").val(@Html.Raw(Json.Encode(Model.Query.Types?.Select(x => x.ToString()))));
            $("select[name='Query.Status']").val(@Html.Raw(Json.Encode(Model.Query.Status?.Select(x => x.ToString()))));
            $('.selectpicker').selectpicker('refresh');

            var clipboardDemos = new Clipboard('[data-clipboard]');
            clipboardDemos.on('success',
                function(e) {
                    e.clearSelection();
                    App.alert({ content:"<h3>复制成功！</h3>"});
                });
        });
    </script>
}