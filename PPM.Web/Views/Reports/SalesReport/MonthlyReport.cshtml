@using PensionInsurance.Shared
@using PensionInsurance.Web.Common
@model PensionInsurance.Web.Views.Reports.SalesReport.MonthlyReportViewModel
@section Styles{
    <!-- BEGIN PAGE LEVEL PLUGINS -->
    <link href=@Url.Content("~/assets/global/plugins/bootstrap-daterangepicker/daterangepicker.min.css") rel="stylesheet" type="text/css" />
    <link href=@Url.Content("~/assets/global/plugins/bootstrap-datepicker/css/bootstrap-datepicker3.min.css") rel="stylesheet" type="text/css" />
    <link href=@Url.Content("~/assets/global/plugins/bootstrap-timepicker/css/bootstrap-timepicker.min.css") rel="stylesheet" type="text/css" />
    <link href=@Url.Content("~/assets/global/plugins/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css") rel="stylesheet" type="text/css" />
    <link href=@Url.Content("~/assets/global/plugins/clockface/css/clockface.css") rel="stylesheet" type="text/css" />

    <link href=@Url.Content("~/assets/global/plugins/select2/css/select2.min.css") rel="stylesheet" type="text/css" />
    <link href=@Url.Content("~/assets/global/plugins/select2/css/select2-bootstrap.min.css") rel="stylesheet" type="text/css" />
    <!-- END PAGE LEVEL PLUGINS -->
}

<!-- BEGIN PAGE BAR -->
@section Breadcrumb{
    <div class="page-bar">
        <ul class="page-breadcrumb">
            <li>
                <a href="@Url.Action("Index","Home")">首页</a>
                <i class="fa fa-circle"></i>
            </li>
            <li>
                <span>管理中心</span>
            </li>
        </ul>
    </div>
}
<!-- END PAGE BAR -->
<!-- BEGIN PAGE TITLE-->
<h3 class="page-title"></h3>
<!-- END PAGE TITLE-->
<!-- END PAGE HEADER-->
<div class="row">
    <div class="col-md-12">

        <div class="portlet light bordered">

            <div class="portlet-body form">
                <!-- BEGIN FORM-->
                <form action="@Url.Action("MonthlyReport", "SalesReport")" class="form-inline">



                    <div class="form-group">
                        <label class="control-label" style="margin-right: 5px;">项目</label>

                        <select name="ProjectId" class="form-control input-sm">
                            @if (WebAppContext.Current.User.GetAllowedProjects().Count > 1)
                            {
                                <option value="">全部</option>
                            }

                            @foreach (var project in Model.Projects.Where(x => x.Id != 0))
                            {
                                <option value="@project.Id" @(project.Id == Model.Query.ProjectId ? "selected" : "")>@project.Name</option>
                            }
                        </select>

                    </div>

                    <div style="margin-left: 10px;" class="form-group">
                        <label class="control-label" style="margin-right: 5px;">开始时间</label>
                        <input style="width: 80px;" name="StartDate" class="input-sm month-picker" data-opts='{"endDate":"@DateTime.Now.AddMonths(-2).ToShortDateString()"}' value="@Model.Query.StartDate.Value.ToString("yyyy-MM")" />
                    </div>

                    <div style="margin-left: 10px;" class="form-group">
                        <label class="control-label" style="margin-right: 5px;">结束时间</label>
                        <input style="width: 80px;" name="EndDate" class="input-sm month-picker" data-opts='{"endDate":"@DateTime.Now.AddMonths(-2).ToShortDateString()"}' value="@Model.Query.EndDate.Value.ToString("yyyy-MM")" />
                    </div>



                    <div style="margin-left: 10px;" class="form-group">
                        <button type="submit" class="btn green btn-sm padding-lf-15 " data-showloading="true">查询</button>
                    </div>

                </form>
                <!-- END FORM-->
            </div>

        </div>

        <div class="table-scrollable">
            <table class="table table-bordered table-report" style="width: 100%">
                <thead>
                    <tr>
                        <th></th>
                        <th></th>
                        @foreach (var year in Model.YearAndMonth.Keys)
                        {
                            <th colspan="@Model.YearAndMonth[year].Count">@year</th>
                        }
                    </tr>

                    <tr>
                        <th></th>
                        <th></th>
                        @foreach (var year in Model.YearAndMonth.Keys)
                        {
                            foreach (var month in Model.YearAndMonth[year])
                            {
                                <th>@($"{year}-{month}")</th>
                            }
                        }
                    </tr>
                </thead>


                @foreach (var projectReport in Model.Reports)
                {
                    <tbody style="border-bottom: 2px solid black; border-top: 2px solid black;">
                        <tr>
                            <td rowspan="8">@projectReport.Key.Name</td>
                            <td>计划入住房间数 Budget total units</td>
                            @foreach (var year in Model.YearAndMonth.Keys)
                            {
                                foreach (var month in Model.YearAndMonth[year])
                                {
                                    <th></th>
                                }
                            }
                        </tr>

                        <tr>
                            <td>当月销售房间数 Monthly Actual Sale</td>
                            @foreach (var year in Model.YearAndMonth.Keys)
                            {
                                foreach (var month in Model.YearAndMonth[year])
                                {
                                    <th>@projectReport.Value[new DateTime(year, month, 1)].MovedInRoomCount</th>
                                }
                            }
                        </tr>

                        <tr>
                            <td>当月入住人数 Monthly Move-in Resident Number</td>
                            @foreach (var year in Model.YearAndMonth.Keys)
                            {
                                foreach (var month in Model.YearAndMonth[year])
                                {
                                    <th>@projectReport.Value[new DateTime(year, month, 1)].MovedInCount</th>
                                }
                            }
                        </tr>

                        <tr>
                            <td>当月退住房间数 Monthly Move-out</td>
                            @foreach (var year in Model.YearAndMonth.Keys)
                            {
                                foreach (var month in Model.YearAndMonth[year])
                                {
                                    <th>@projectReport.Value[new DateTime(year, month, 1)].MovedOutRoomCount</th>
                                }
                            }
                        </tr>

                        <tr>
                            <td>当月退住人数 Monthy Move-out Resident Number</td>
                            @foreach (var year in Model.YearAndMonth.Keys)
                            {
                                foreach (var month in Model.YearAndMonth[year])
                                {
                                    <th>@projectReport.Value[new DateTime(year, month, 1)].MovedOutCount</th>
                                }
                            }
                        </tr>

                        <tr>
                            <td>实际入住房间数 Totally Actual</td>
                            @foreach (var year in Model.YearAndMonth.Keys)
                            {
                                foreach (var month in Model.YearAndMonth[year])
                                {
                                    <th>@projectReport.Value[new DateTime(year, month, 1)].TotalMovedInRoomCount</th>
                                }
                            }
                        </tr>

                        <tr>
                            <td>实际入住人数 Actual Resident Number </td>
                            @foreach (var year in Model.YearAndMonth.Keys)
                            {
                                foreach (var month in Model.YearAndMonth[year])
                                {
                                    <th>@projectReport.Value[new DateTime(year, month, 1)].TotalMovedInCount</th>
                                }
                            }
                        </tr>

                        <tr>
                            <td>入住率 Actual Occupancy</td>
                            @foreach (var year in Model.YearAndMonth.Keys)
                            {
                                foreach (var month in Model.YearAndMonth[year])
                                {
                                    <th>@projectReport.Value[new DateTime(year, month, 1)].Rate.FormatString()</th>
                                }
                            }
                        </tr>
                    </tbody>
                }

            </table>
        </div>
    </div>
</div>

@section Scripts{
    <!-- BEGIN PAGE LEVEL PLUGINS -->
    <script src=@Url.Content("~/assets/global/plugins/bootstrap-fileinput/bootstrap-fileinput.js") type="text/javascript"></script>
    <!-- END PAGE LEVEL PLUGINS -->
    <script src=@Url.Content("~/assets/global/plugins/moment.min.js") type="text/javascript"></script>
    <script src=@Url.Content("~/assets/global/plugins/bootstrap-daterangepicker/daterangepicker.min.js") type="text/javascript"></script>
    <script src=@Url.Content("~/assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js") type="text/javascript"></script>
    <script src=@Url.Content("~/assets/global/plugins/bootstrap-timepicker/js/bootstrap-timepicker.min.js") type="text/javascript"></script>
    <script src=@Url.Content("~/assets/global/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js") type="text/javascript"></script>
    <script src=@Url.Content("~/assets/global/plugins/clockface/js/clockface.js") type="text/javascript"></script>
    <script src=@Url.Content("~/assets/global/scripts/app.min.js") type="text/javascript"></script>
    <script src=@Url.Content("~/assets/global/plugins/select2/js/select2.full.min.js") type="text/javascript"></script>

}