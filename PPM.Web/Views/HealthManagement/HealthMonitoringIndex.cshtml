@using PensionInsurance.Entities
@using Foundation.Core
@using PensionInsurance.Shared
@using PensionInsurance.Web.Common
@using PensionInsurance.Web.Views.HealthManagement
@model PensionInsurance.Web.Views.HealthManagement.HealthMonitoringViewModel
@section Styles{
    <!-- BEGIN PAGE LEVEL PLUGINS -->

    <link href=@Url.Content("~/assets/global/plugins/layui/css/layui.css") rel="stylesheet" type="text/css" />
    <link href=@Url.Content("~/assets/global/plugins/bootstrap-daterangepicker/daterangepicker.min.css") rel="stylesheet" type="text/css" />
    <link href=@Url.Content("~/assets/global/plugins/bootstrap-datepicker/css/bootstrap-datepicker3.min.css") rel="stylesheet" type="text/css" />
    <link href=@Url.Content("~/assets/global/plugins/bootstrap-timepicker/css/bootstrap-timepicker.min.css") rel="stylesheet" type="text/css" />
    <link href=@Url.Content("~/assets/global/plugins/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css") rel="stylesheet" type="text/css" />
    <link href=@Url.Content("~/assets/global/plugins/clockface/css/clockface.css") rel="stylesheet" type="text/css" />
    <link href=@Url.Content("~/assets/global/plugins/select2/css/select2.min.css") rel="stylesheet" type="text/css" />
    <link href=@Url.Content("~/assets/global/plugins/select2/css/select2-bootstrap.min.css") rel="stylesheet" type="text/css" />
    <link href=@Url.Content("~/assets/global/plugins/jstree/dist/themes/default/style.min.css") rel="stylesheet" type="text/css" />

    <!-- END PAGE LEVEL PLUGINS -->
}
<!-- BEGIN PAGE BAR -->
@section Breadcrumb{
    <div class="page-bar">
        <ul class="page-breadcrumb">
            <li>
                <a href="@Url.Action("Index", "HealthManagement")">健康体检首页</a>
                <i class="fa fa-circle"></i>
            </li>
            @if (Model.CheckStatus == "-1")
            {
                <li>
                    <a href="@Url.Action("MoreCustomerHealthIndex", "HealthManagement")">退住客户健康体检管理</a>
                    <i class="fa fa-circle"></i>
                </li>
            }
            <li>
                <span>健康检测指标</span>
            </li>
        </ul>
    </div>
}
<!-- END PAGE BAR -->
<div class="row margin-top-10">
    <div style="float:left; width:180px;">
        @Html.Partial("_LeftMenuInfo", Model)
    </div>
    <div style="float:left;width:calc(100% - 210px);">
        <div class="form-body">
            @Html.Partial("_CustomerBasicInfo", Model)
        </div>

        <div class="row margin-top-10">
            <div class="col-md-12">
                <div class="tabbable-custom">
                    <ul class="nav nav-tabs">
                        <li class="active">
                            <a data-showloading="true" href="@Url.Action("HealthMonitoringIndex", "HealthManagement", new { customerAccountId = Model.CustomerInfo.CustomerAccountId, healthStatus = Model.HealthReportStatus })"> 健康检测指标 </a>
                        </li>
                        <li class="">
                            <a data-showloading="true" href="@Url.Action("Index", "GraphicReport", new { customerAccountId = Model.CustomerInfo.CustomerAccountId, healthStatus = Model.HealthReportStatus })"> 图文报告 </a>
                        </li>
                        <li class="">
                            <a data-showloading="true" href="@Url.Action("HealthManageReport", "HealthManagement", new { customerAccountId = Model.CustomerInfo.CustomerAccountId, healthStatus = Model.HealthReportStatus })"> 健康报告 </a>
                        </li>
                    </ul>
                    @{
                        var color = "";
                    }
                    <div class="tab-content">
                        <div class="table table-scrollable">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th class="health-indicator-cell text-center" style="width:15%">分类</th>
                                        <th class="health-indicator-cell text-center" style="width:20%">检查项目</th>
                                        <th class="health-indicator-cell text-center" style="width:30%">检查结果</th>
                                        <th class="health-indicator-cell text-center" style="width:35%">参考标准</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @{
                                        var healthCategory = Model.HMVList.Select(x => x.TitleName).Distinct().ToList();
                                        foreach (var categoryName in healthCategory)
                                        {
                                            var categoryList = Model.HMVList.Where(x => x.TitleName == categoryName).ToList();
                                            var rowspan = categoryList.Count;

                                            for (int i = 0; i < rowspan; i++)
                                            {
                                                var healthModel = categoryList[i];
                                                var colName = healthModel.ColName == "血糖" ? "血糖（血糖类型）" : healthModel.ColName;
                                                <tr>
                                                    @if (i == 0)
                                                    {
                                                        <td rowspan=@rowspan class="health-indicator-cell text-center" style="vertical-align:middle;border-right: 1px solid #e7ecf1">@healthModel.TitleName</td>
                                                    }
                                                    @if (healthModel.TitleName == "中医体质")
                                                    {
                                                        <td colspan="3" class="health-indicator-cell text-center">@healthModel.ColVal</td>
                                                    }
                                                    else
                                                    {
                                                        <td class="health-indicator-cell text-center" style="border-right: 1px solid #e7ecf1">@colName</td>
                                                        <td class="health-indicator-cell text-center" style="border-right: 1px solid #e7ecf1">
                                                            @{
                                                                color = healthModel.ColOK ? "green" : "red";
                                                                if (healthModel.ColVal == "--")
                                                                {
                                                                    color = "";
                                                                }

                                                            }
                                                            @if (healthModel.ColPoint == false)
                                                            {
                                                                <span style="none;color: @color">@healthModel.ColVal</span>
                                                            }
                                                            else
                                                            {
                                                                if (healthModel.ColName == "血压")
                                                                {
                                                                    <a style="text-decoration:none;color: @color" href="@Url.Action("HealthDetailForBloodPresure", "HealthManagement", new { @id = Model.CustomerInfo.CustomerAccountId, @healthStatus = Model.HealthReportStatus, @ColName = healthModel.ColName })">
                                                                        @healthModel.ColVal
                                                                    </a>
                                                                }
                                                                else
                                                                {
                                                                    <a style="text-decoration:none;color: @color" href="@Url.Action("HealthDetail", "HealthManagement", new { @id = Model.CustomerInfo.CustomerAccountId, @healthStatus = Model.HealthReportStatus, @ColName = healthModel.ColName })">
                                                                        @healthModel.ColVal
                                                                    </a>
                                                                }
                                                            }
                                                        </td>
                                                        <td class="health-indicator-cell text-center">
                                                            @healthModel.HealthStandard
                                                        </td>
                                                    }
                                                </tr>
                                            }


                                        }
                                    }
                                </tbody>
                            </table>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="text-right">
            @if (PensionInsurance.Shared.WebAppContext.Current.User.HasPermission(ModuleType.健康管理, Permission.编辑健康报告) && Model.HealthReportStatus == 2)
            {
                <button type="button" class="btn green" onclick="EditHealthReport(@Model.HealthReportStatus);"><i class="fa fa-edit"></i>提交健康报告</button>
            }

            @if (PensionInsurance.Shared.WebAppContext.Current.User.HasPermission(ModuleType.健康管理, Permission.编辑健康报告) && Model.HealthReportStatus == 1)
            {
                <button type="button" class="btn green" onclick="EditHealthReport(@Model.HealthReportStatus);"><i class="fa fa-edit"></i>查看健康报告</button>
            }
        </div>
    </div>
</div>


@section Scripts{
    <script src=@Url.Content("~/assets/global/plugins/layui/layui.all.js") type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function () {


        });

        function EditHealthReport(healthStatus) {
            var accountId =@Html.Raw(Model.CustomerInfo.CustomerAccountId);
            var status=@Html.Raw(Model.HealthReportStatus);
           // if (healthStatus == 2) {
                location.href = "HealthManageReport?customerAccountId=" + accountId + "&healthStatus=" + status;
            //}
            //else {
            //    layer.confirm('健康报告已编辑,是否要去修改?', {
            //        btn: ['去修改', '取消']//按钮
            //    }, function (index) {
            //        layer.close(index);
            //        location.href = "HealthManageReport?customerAccountId=" + accountId + "&healthStatus=" + status + "&editStatus=1";
            //    });
            //}
        }
    </script>
}