@using PensionInsurance.Entities
@using Foundation.Core
@using PensionInsurance.Shared
@using PensionInsurance.Web.Common
@using PensionInsurance.Web.Views.HealthManagement
@model PensionInsurance.Web.Views.HealthManagement.HealthMonitoringViewModel
@section Styles{
    <!-- BEGIN PAGE LEVEL PLUGINS -->
    <link href=@Url.Content("~/assets/global/plugins/layui/css/layui.css") rel="stylesheet" type="text/css" />
    <link href=@Url.Content("~/assets/global/plugins/bootstrap-daterangepicker/daterangepicker.min.css") rel="stylesheet" type="text/css" />
    <link href=@Url.Content("~/assets/global/plugins/bootstrap-datepicker/css/bootstrap-datepicker3.min.css") rel="stylesheet" type="text/css" />
    <link href=@Url.Content("~/assets/global/plugins/bootstrap-timepicker/css/bootstrap-timepicker.min.css") rel="stylesheet" type="text/css" />
    <link href=@Url.Content("~/assets/global/plugins/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css") rel="stylesheet" type="text/css" />
    <link href=@Url.Content("~/assets/global/plugins/clockface/css/clockface.css") rel="stylesheet" type="text/css" />
    <link href=@Url.Content("~/assets/global/plugins/select2/css/select2.min.css") rel="stylesheet" type="text/css" />
    <link href=@Url.Content("~/assets/global/plugins/select2/css/select2-bootstrap.min.css") rel="stylesheet" type="text/css" />
    <link href=@Url.Content("~/assets/global/plugins/jstree/dist/themes/default/style.min.css") rel="stylesheet" type="text/css" />
    <script src=@Url.Content("~/assets/global/plugins/echarts/echarts.min.js") type="text/javascript"></script>

    <!-- END PAGE LEVEL PLUGINS -->
}
@section Breadcrumb{
    <div class="page-bar">
        <ul class="page-breadcrumb">
            <li>
                <a href="@Url.Action("Index", "HealthManagement")">健康体检首页</a>
                <i class="fa fa-circle"></i>
            </li>
            @if (Model.CheckStatus == "-1")
            {
                <li>
                    <a href="@Url.Action("MoreCustomerHealthIndex", "HealthManagement")">退住客户健康体检管理</a>
                    <i class="fa fa-circle"></i>
                </li>
            }
            <li>
                <a href="@Url.Action("HealthMonitoringIndex", "HealthManagement", new {customerAccountId = Model.CustomerInfo.CustomerAccountId,healthStatus=Model.HealthReportStatus})">健康检测指标</a>
                <i class="fa fa-circle"></i>
            </li>
            <li>
                <span>@Model.DetailTypeName</span>
            </li>
        </ul>
    </div>
}

<div>
    <div style="float:left; width:180px;">
        @Html.Partial("_LeftMenuInfo", Model)
    </div>
    <div style="float:left;width:calc(100% - 210px);">
        <div class="form-body">
            @Html.Partial("_CustomerBasicInfo", Model)
        </div>

        <div class="row margin-top-10">
            <div class="col-md-12">
                <div class="tabbable-custom">
                    <ul class="nav nav-tabs">
                        <li class="active">
                            <a data-showloading="true" href="@Url.Action("HealthMonitoringIndex", "HealthManagement", new {customerAccountId = Model.CustomerInfo.CustomerAccountId,healthStatus=Model.HealthReportStatus})"> 健康检测指标 </a>
                        </li>
                        <li class="">
                            <a data-showloading="true" href="@Url.Action("Index", "GraphicReport",new {customerAccountId = Model.CustomerInfo.CustomerAccountId,healthStatus=Model.HealthReportStatus})"> 图文报告 </a>
                        </li>
                        <li class="">
                            <a data-showloading="true" href="@Url.Action("HealthManageReport", "HealthManagement", new {customerAccountId = Model.CustomerInfo.CustomerAccountId,healthStatus=Model.HealthReportStatus})"> 健康报告 </a>
                        </li>
                    </ul>

                    <div class="tab-content">
                        @*<div style="font-weight:bold; font-size:14px"><a style="text-decoration:none;" data-showloading="true" href="@Url.Action("HealthMonitoringIndex", "HealthManagement", new {customerAccountId = Model.CustomerInfo.CustomerAccountId,healthStatus=Model.HealthReportStatus})">健康检测指标</a><span>-</span>@Model.DetailTypeName</div>*@
                        <div style="background: #fff">
                            <div id="history" style="width: 100%; height: 320px;"></div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <div class="text-right">
            @if (PensionInsurance.Shared.WebAppContext.Current.User.HasPermission(ModuleType.健康管理, Permission.编辑健康报告) && Model.HealthReportStatus == 2)
            {
                <button type="button" class="btn green" onclick="EditHealthReport(@Model.HealthReportStatus);"><i class="fa fa-edit"></i>提交健康报告</button>
            }
            @if (PensionInsurance.Shared.WebAppContext.Current.User.HasPermission(ModuleType.健康管理, Permission.编辑健康报告) && Model.HealthReportStatus == 1)
            {
                <button type="button" class="btn green" onclick="EditHealthReport(@Model.HealthReportStatus);"><i class="fa fa-edit"></i>查看健康报告</button>
            }
        </div>
    </div>
</div>



@section Scripts{
    <script src=@Url.Content("~/assets/global/plugins/layui/layui.all.js") type="text/javascript"></script>
    <script type="text/javascript">
        function EditHealthReport(healthStatus) {
            var accountId =@Html.Raw(Model.CustomerInfo.CustomerAccountId);
            var status=@Html.Raw(Model.HealthReportStatus);
           // if (healthStatus == 2) {
            location.href = "/HealthManagement/HealthManageReport?customerAccountId=" + accountId + "&healthStatus=" + status;
            //}
            //else {
            //    layer.confirm('健康报告已编辑,是否要去修改?', {
            //        btn: ['去修改', '取消']//按钮
            //    }, function (index) {
            //        layer.close(index);
            //        location.href = "HealthManageReport?customerAccountId=" + accountId + "&healthStatus=" + status + "&editStatus=1";
            //    });
            //}
        }
    var myChart = echarts.init(document.getElementById('history'));
    var myDate = [
        @Html.Raw(string.Join(",", Model.CustomerHealthForBloodPresureInfo.Histories.Select(x=>$"'{x.CheckDate}'")))
    ];
    var myValueHigh =[
        @Html.Raw(string.Join(",", Model.CustomerHealthForBloodPresureInfo.Histories.Select(x=>$"'{x.ValueHigh}'")))
        ];
    var myValueLow =[
        @Html.Raw(string.Join(",", Model.CustomerHealthForBloodPresureInfo.Histories.Select(x=>$"'{x.ValueLow}'")))
        ];
    var yName =
        '    @Html.Raw(Model.CustomerHealthForBloodPresureInfo.Histories.FirstOrDefault().DetailType + "(" + Model.CustomerHealthForBloodPresureInfo.Histories.FirstOrDefault().Unit + ")")';
    var maxData = @Html.Raw(Model.CustomerHealthForBloodPresureInfo.MaxValue);
    var minData = @Html.Raw(Model.CustomerHealthForBloodPresureInfo.MinValue);
    // 指定图表的配置项和数据
        option = {
            legend: {
                data:['收缩压','舒张压']
            },
            tooltip: {
                trigger: 'axis'
            },
            xAxis: {
                name: '日期',
            type: 'category',
            data: myDate
        },
        yAxis: {
            name: yName,
            type: 'value',
            min: minData,
            max: maxData
        },
        series: [{
            name:'收缩压',
            data: myValueHigh,
            type: 'line',
            //线颜色设置
            itemStyle: {
                normal: {
                    color: '#FF9224'
                }
            },
            //阴影颜色
            areaStyle: {
                normal: {
                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                        offset: 0,
                        color: '#FFE153'
                    }, {
                        offset: 1,
                        color: '#ffe'
                    }])
                }
            }
        },
        {
            name:'舒张压',
            data: myValueLow,
            type: 'line',
            //线颜色设置
            itemStyle: {
                normal: {
                    color: '#8CEA00'
                }
            },
            //阴影颜色
            areaStyle: {
                normal: {
                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                        offset: 0,
                        color: '#B7FF4A'
                    }, {
                        offset: 1,
                        color: '#ffe'
                    }])
                }
            }
        }
        ]
    };


    // 使用刚指定的配置项和数据显示图表。
    myChart.setOption(option);
    </script>
}
