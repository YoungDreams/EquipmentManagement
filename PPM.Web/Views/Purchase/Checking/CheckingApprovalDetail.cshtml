@using PensionInsurance.Entities
@using PensionInsurance.Shared
@using PensionInsurance.Web.Common
@model PensionInsurance.Web.Views.Purchase.Checking.CheckingProjectItemApprovalViewModel
<!-- BEGIN PAGE BAR -->
<style>
    #productlist td {
        text-align: center;
    }

    #productlist th {
        text-align: center;
    }
</style>
@section Breadcrumb{
    <div class="page-bar">
        <ul class="page-breadcrumb">
            <li>
                <a href="@Url.Action("Index","Home")">首页</a>
                <i class="fa fa-circle"></i>
            </li>
            <li>
                <a href="@Url.Action("Index", "Order" )">采购管理</a>
                <i class="fa fa-circle"></i>
            </li>
            <li>
                <span>盘点审批</span>
            </li>
        </ul>
    </div>
}
<!-- END PAGE BAR -->
<div class="row">
    <div class="col-md-12">
        <div class="portlet" style="margin-top: 10px;">
            <div class="portlet-title">
                <div class="caption">
                    <i class="fa fa-gift"></i>盘点信息
                </div>
            </div>
            <div class="portlet-body form">
                <!-- BEGIN FORM-->

                <div class="form-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="control-label col-md-3">项目</label>
                                <div class="col-md-9">
                                    @Model.CheckingProject.Project.Name
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="control-label col-md-3">盘点月份</label>
                                <div class="col-md-9">
                                    @Model.OpenDate.ToString("yyyy-MM")
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--/row-->
                </div>
                <!-- END FORM-->
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <div class="portlet light bordered">
            <div class="portlet-title">
                <div class="caption">
                    <i class="icon-social-dribbble font-green"></i>
                    <span class="caption-subject font-green bold uppercase">库存盘点</span>
                </div>
            </div>
            <div class="portlet-body">

                <div class="table">
                    <table id="checkingProjectItemList" class="table table-hover table-scrollable">
                        <thead>
                            <tr>
                                <th> 序号 </th>
                                <th> 产品编码 </th>
                                <th> 产品名称 </th>
                                <th> 产品分类 </th>
                                <th> 供应商 </th>
                                <th> 品牌 </th>
                                <th> 规格 </th>
                                <th> 单位 </th>
                                <th> 期初数量 </th>
                                <th> 本月入库数 </th>
                                <th> 本月出库数 </th>
                                <th> 期末库存 </th>
                                <th> 盘点数量 </th>
                                <th> 盘点时间 </th>
                                <th> 盘点人 </th>
                                <th> 备注及用途 </th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                var index = 0;
                            }
                            @foreach (var item in Model.Items)
                            {
                                <tr>
                                    <input type="hidden" name="CheckingProjectItems[@index].PurchaseProductStockId" value="@item.PurchaseProductStockId" />
                                    <input type="hidden" name="CheckingProjectItems[@index].Stock" value="@item.Stock" />
                                    <input type="hidden" name="CheckingProjectItems[@index].PurchaseProductId" value="@item.PurchaseProductId" />
                                    <td> @Model.Items.RowNumberOf(item) </td>
                                    <td> @item.ProductCode </td>
                                    <td> @item.PurchaseProductName </td>
                                    <td> @item.PurchaseProductCategory </td>
                                    <td> @item.PurchaseSupplier </td>
                                    <td> @item.Brand </td>
                                    <td> @item.Specification </td>
                                    <td> @item.Unit </td>
                                    <td> @item.LastMonthCheckCount </td>
                                    <td> @item.CurrentMonthStockInCount </td>
                                    <td class="a"> @item.CurrentMonthStockOutCount </td>
                                    <td class="b"> @item.CurrentCheckCount </td>
                                    <td>
                                        @item.CheckingQuantity
                                    </td>
                                    <td> @Model.OpenDate.ToShortDateString() </td>
                                    <td> @Model.PersonName </td>
                                    <td>
                                        @item.Remarks
                                    </td>
                                </tr>
                                index++;
                            }
                        </tbody>
                    </table>
                </div>
                @if (Model.CurrentWorkFlowStep != null)
                {
                    @Html.Partial("~/Views/Purchase/Checking/_Approval.cshtml", Model)
                }
                else
                {
                    @Html.Partial("~/Views/TrackingResult/_TrackingResults.cshtml", Model.TrackingResult)
                }
            </div>
        </div>
    </div>

</div>
<div class="form-actions">
    <div class="text-center">
        @if (Model.CurrentWorkFlowStep != null && Model.CurrentWorkFlowStep.User == WebAppContext.Current.User)
        {
            <button id="ApartmentApproval" class="btn green btn-sm padding-lf-15 ">提交</button>
        }
    </div>
</div>

<script src="@Url.Content("~/assets/global/plugins/bootstrap-touchspin/bootstrap.touchspin.js")" type="text/javascript"></script>
<script>
    $(document).ready(function() {
        $("#printTitle").hide();
        //审批保存
        $("#ApartmentApproval").on("click",
            function() {
                $("#Description").text();
                var url = '@Url.Action("Approval", "Checking")';
                var checkingProjectId = @Model.CheckingProject.Id;
                var result = $("input[name='Result']:checked").val();
                var description = $('#Description').val();
                var currentWorkflowStepId = @Model.CurrentWorkflowStepId;
                if (typeof result == "undefined") {
                    result = "";
                }
                var command = {
                    CheckingProjectId: checkingProjectId,
                    Result: result,
                    Description: description,
                    CurrentWorkflowStepId: currentWorkflowStepId
                };
                postCommand(url, command, $(this));
                return false;
            });
    });
</script>
