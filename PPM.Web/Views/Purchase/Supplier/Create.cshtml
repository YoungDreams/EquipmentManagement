@using PensionInsurance.Web.Common
@model PensionInsurance.Web.Views.Purchase.Supplier.CreateViewModel
@section Styles{
    <!-- BEGIN PAGE LEVEL PLUGINS -->
    <link href=@Url.Content("~/assets/global/plugins/bootstrap-select/css/bootstrap-select.min.css") rel="stylesheet" type="text/css" />
    <!-- END PAGE LEVEL PLUGINS -->
    <style type="text/css">
        .select2-selection__rendered {
            height: 28px !important;
        }

        .select2-selection__choice {
            margin-top: 0px !important;
        }

        .select2-selection--multiple {
            height: 22px !important;
            min-height: 22px !important;
        }
    </style>
}
<!-- BEGIN PAGE BAR -->
@section Breadcrumb{
    <div class="page-bar">
        <ul class="page-breadcrumb">
            <li>
                <a href="@Url.Action("Index","Home")">首页</a>
                <i class="fa fa-circle"></i>
            </li>
            <li>
                <a href="@Url.Action("Index", "Purchase")">采购管理</a>
                <i class="fa fa-circle"></i>
            </li>
            <li>
                <a href="@Url.Action("Index", "Supplier")">供应商管理</a>
                <i class="fa fa-circle"></i>
            </li>
            <li>
                <span>新增</span>
            </li>
        </ul>
    </div>
}
<div class="full-height-content full-height-content-scrollable">
    <div class="full-height-content-body">
        <form data-ajax="true" action="@Url.Action("Create", "Supplier")" method="POST" enctype="multipart/form-data">
            <div class="portlet" style="margin-top: 10px;">
                <div class="portlet-title">
                    <div class="caption">
                        <i class="fa fa-gift"></i>供应商信息
                    </div>
                </div>
                <div class="portlet-body form">
                    <!-- BEGIN FORM-->
                    <div class="form-body">
                        <div class="row margin-top-10">
                            <div class="col-md-6 col-md-offset-2">
                                <div class="form-group">
                                    <label class="text-right col-md-3">
                                        供应商名称
                                        <span class="required" aria-required="true"> * </span>
                                    </label>
                                    <div class="col-md-9">
                                        @Html.InputText(m => m.Name, new { @maxlength = "20", @class = "form-control" })
                                    </div>
                                </div>
                            </div>
                            <!--/span-->
                        </div>
                        <div class="row margin-top-10">
                            <div class="col-md-6 col-md-offset-2">
                                <div class="form-group">
                                    <label class="text-right col-md-3">
                                        城市
                                        <span class="required" aria-required="true"> * </span>
                                    </label>
                                    <div class="col-md-9 cell">
                                        @Html.DropDownListFor(x => x.AreaIds, Model.Cities, new { @multiple = "multiple", @class = "form-control" })
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row margin-top-10">
                            <div class="col-md-6 col-md-offset-2">
                                <div class="form-group">
                                    <label class="text-right col-md-3">
                                        项目
                                        <span class="required" aria-required="true"> * </span>
                                    </label>
                                    <div class="col-md-9 cell">
                                        @Html.DropDownListFor(x => x.ProjectIds, Model.Projects, new { @multiple = "multiple", @class = "form-control" })
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row margin-top-10">
                            <div class="col-md-6 col-md-offset-2">
                                <div class="form-group">
                                    <label class="text-right col-md-3">
                                        联系人
                                        <span class="required" aria-required="true"> * </span>
                                    </label>
                                    <div class="col-md-9">
                                        @Html.InputText(m => m.ContactPerson, new { @maxlength = "255", @class = "form-control" })
                                    </div>
                                </div>
                            </div>
                            <!--/span-->
                        </div>
                        <div class="row margin-top-10">
                            <div class="col-md-6 col-md-offset-2">
                                <div class="form-group">
                                    <label class="text-right col-md-3">
                                        联系电话
                                        <span class="required" aria-required="true"> * </span>
                                    </label>
                                    <div class="col-md-9">
                                        @Html.InputText(m => m.ContactPhone, new { @maxlength = "255", @class = "form-control" })
                                    </div>
                                </div>
                            </div>
                            <!--/span-->
                        </div>
                        <div class="row margin-top-10">
                            <div class="col-md-6 col-md-offset-2">
                                <div class="form-group">
                                    <label class="text-right col-md-3">
                                        邮箱
                                        <span class="required" aria-required="true"> * </span>
                                    </label>
                                    <div class="col-md-9">
                                        @Html.InputText(m => m.Email, new { @maxlength = "255", @class = "form-control" })
                                    </div>
                                </div>
                            </div>
                            <!--/span-->
                        </div>
                        <div class="row margin-top-10">
                            <div class="col-md-6 col-md-offset-2">
                                <div class="form-group">
                                    <label class="text-right col-md-3">
                                        开户行
                                        <span class="required" aria-required="true"> * </span>
                                    </label>
                                    <div class="col-md-9">
                                        @Html.InputText(m => m.BankName, new { @maxlength = "255", @class = "form-control" })
                                    </div>
                                </div>
                            </div>
                            <!--/span-->
                        </div>
                        <div class="row margin-top-10">
                            <div class="col-md-6 col-md-offset-2">
                                <div class="form-group">
                                    <label class="text-right col-md-3">
                                        开户账号
                                        <span class="required" aria-required="true"> * </span>
                                    </label>
                                    <div class="col-md-9">
                                        @Html.InputText(m => m.BankAccount, new { @maxlength = "255", @class = "form-control" })
                                    </div>
                                </div>
                            </div>
                            <!--/span-->
                        </div>
                        <div class="row margin-top-10">
                            <div class="col-md-6 col-md-offset-2">
                                <div class="form-group">
                                    <label class="text-right col-md-3">
                                        起订量（元）
                                        <span class="required" aria-required="true"> * </span>
                                    </label>
                                    <div class="col-md-9">
                                        @Html.InputText(m => m.MinOrderMoney, new { @style = "resize: none;", @onkeyup = "this.value = this.value.replace(/[^\\d]/g, '')", @onafterpaste = "this.value = this.value.replace(/[^\\d]/g, '')", @maxlength = "10", @class = "form-control" })
                                    </div>
                                </div>
                            </div>
                            <!--/span-->
                        </div>

                        <div class="row margin-top-10">
                            <div class="col-md-6 col-md-offset-2">
                                <div class="form-group">
                                    <label class="text-right col-md-3">状态</label>
                                    <div class="col-md-9">
                                        @Html.BooleanRadioButtonFor(m=>m.Status)
                                    </div>
                                </div>
                            </div>
                            <!--/span-->
                        </div>

                        <div class="row margin-top-10">
                            <div class="col-md-6 col-md-offset-2">
                                <div class="form-group">
                                    <label class="text-right col-md-3">备注</label>
                                    <div class="col-md-9">
                                        @Html.InputText(m => m.Note, new { maxlength = "255", @class = "form-control" })
                                    </div>
                                </div>
                            </div>
                            <!--/span-->
                        </div>
                        <div class="errors alert alert-danger fade in" style="display: none;"></div>
                        <!--/row-->
                        <div class="row margin-top-10 text-center">
                            <div class="col-md-12">
                                <button type="submit" class="btn btn-sm green">保存</button>
                                <button type="button" class="btn yellow btn-sm padding-lf-15" onclick="javascript: history.back(-1);">返回上一页</button>
                            </div>
                        </div>
                        <!-- END FORM-->
                    </div>
                    <!-- END FORM-->
                </div>
            </div>
        </form>
    </div>
</div>
@section Scripts{
    <script src=@Url.Content("~/assets/global/plugins/bootstrap-select/js/bootstrap-select.min.js") type="text/javascript"></script>
    <script src=@Url.Content("~/assets/global/plugins/jquery-validation/js/jquery.validate.min.js") type="text/javascript"></script>
    <script type="text/javascript">
        var getProjects = function (cityId, projectId) {
            var url = "@Url.Action("GetProjectsJson", "Supplier")" + "?cityid=" + cityId;
            if (projectId) {
                url += "&projectId="+projectId;
            }
            $.get(url, function (result) {
                var selector = 'select[name="ProjectIds"]';
                $(selector).html("");
                for (var i = 0; i < result.length; i++) {
                    var selected = result[i].Selected ? "selected" : "";
                    var option = '<option value="' + result[i].Value + '"' + selected + '>' + result[i].Text + '</option>';
                    $(selector).append(option);
                }
                //$("select[name='Query.ProjectIds']").val(null)
            });
        }
        $(document).ready(function() {

            $("select[name='AreaIds'], select[name='ProjectIds']").select2({
                theme: "classic",
                width: 'resolve',
                language: "zh-CN",
                //data: ['110100']
                //matcher: matchCustom
            });

            $("select[name='AreaIds']").on('change', function () {
                var cityids = $(this).val();
                var projectIds = $("select[name='ProjectIds']").val();
                getProjects(cityids, projectIds);
            });

            function matchCustom(params, data) {
                // If there are no search terms, return all of the data
                if ($.trim(params.term) === '') {
                    return data;
                }

                // Do not display the item if there is no 'text' property
                if (typeof data.text === 'undefined') {
                    return null;
                }

                // `params.term` should be the term that is used for searching
                // `data.text` is the text that is displayed for the data object
                if (data.text.indexOf(params.term) > -1) {
                    var modifiedData = $.extend({}, data, true);
                    modifiedData.text += ' (matched)';

                    // You can return modified objects from here
                    // This includes matching the `children` how you want in nested data sets
                    return modifiedData;
                }

                // Return `null` if the term should not be displayed
                return null;
            }
        });

        $(document).on(
            "change",
            "select[name='AreaIds'],select[name='ProjectIds']",
            function() {
                var $this = $(this);
                if ($this.val()) {
                    $this.parents(".cell").addClass("has-success").removeClass("has-error");
                } else {
                    $this.parents(".cell").addClass("has-error").removeClass("has-success");
                }
            });
    </script>
}
