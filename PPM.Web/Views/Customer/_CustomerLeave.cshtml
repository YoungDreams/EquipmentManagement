@using PensionInsurance.Entities
@using PensionInsurance.Shared
@using PensionInsurance.Web.Common
@model PensionInsurance.Web.Views.Customer.DetailViewModel
<div class="row" style="margin-top: 10px;">
    <div class="col-md-12">
        <div class="portlet-body">
            <div class="table-scrollable">
                <table id="customer-leave-items" class="table table-hover" data-src="@Url.Action("Detail", "Customer", new {customerId = Model.CustomerInfo.CustomerId, customerAccountId = Model.CustomerAccountId})">
                    <thead>
                    <tr>
                        <th>开始时间</th>
                        <th>结束时间</th>
                        <th>请假原因</th>
                        <th>销假时间</th>
                        <th>离开天数</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    @foreach (var item in Model.CustomerLeaveList)
                    {
                        <tr>
                            <td style="white-space: nowrap;">@item.StartTime.DateTimeString()</td>
                            <td style="white-space: nowrap;">@item.EndTime.DateTimeString()</td>
                            <td>@item.Reason.SubString(20, "...")</td>
                            <td style="white-space: nowrap;">@(item.ResumptionTime?.DateTimeString())</td>
                            <td>@item.LeaveAmount</td>
                            <td>
                                <div class="btn-group">
                                    @if (item.ResumptionTime == null)
                                    {
                                        if (PensionInsurance.Shared.WebAppContext.Current.User.HasPermission(ModuleType.客户请假, Permission.打印))
                                        {
                                            <a href="javascript:;"  class="btn default btn-xs yellow-stripe">打印</a>
                                        }
                                        if (PensionInsurance.Shared.WebAppContext.Current.User.HasPermission(ModuleType.客户请假, Permission.删除))
                                        {
                                            <a href="javascript:;" data-command="@Model.DeleteCustomerLeaveCommand(item.Id).ToJavascript()" class="btn default btn-xs red-stripe">
                                                删除
                                            </a>
                                        }
                                    }
                                    else
                                    {
                                        <a class="btn default btn-xs yellow-stripe back-customer-leave" data-src="@Url.Action("BackCustomerLeave", "Customer", new {customerLeaveId = item.Id})" href="javascript:;">编辑</a>
                                    }
                                </div>
                            </td>
                        </tr>
                    }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function() {
        $(document)
            // 亲属信息
            .on("click", ".add-customer-leave", function() {
                App.dialog('#customer-leave-create-form', '@Url.Action("CreateCustomerLeave","Customer",new { customerAccountId = Model.CustomerAccountId})');
            }).on("click", ".back-customer-leave", function() {
                var src = $(this).attr("data-src");
                App.dialog('#customer-leave-back-modal',src);
            });
    });
</script>